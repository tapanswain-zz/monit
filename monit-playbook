#!/usr/bin/ansible-playbook 
---
### ---------------------------------------------------------------------
### playbooks/monit config
### ---------------------------------------------------------------------
###
###    1. copy source from monit site.
###    2. untar the source.
###    3. copy the configuration file.
###    4. run monit
###   
###
### ---------------------------------------------------------------------
- hosts: "{{ hosts }}"
  user: root
  serial: 1
  gather_facts: false

  tasks:
    #--------------------------------------------------------
    # 1.  Install monit using tar 
    # ---------------------------------------------------------------------
     - name: "copy source from monit site"
       shell: " wget {{ auth_url }}/{{ monit_version }}/{{ pkg_name }}"
       args:
         creates: /opt/monit
         chdir: /opt/monit
    #--------------------------------------------------------
    # 2. untar 
    # ---------------------------------------------------------------------
     - name: "untar the source"
       shell: "/bin/tar -zxf {{ pkg_name }}
       args:
         chdir: /opt/monit

    #--------------------------------------------------------
    # 3. copy the configuration file
    # ---------------------------------------------------------------------
     - name: "copy the config file"
       template: 
         src: "monitrc"
         dest: "/etc/monitrc"
         mode: 0700

    #--------------------------------------------------------
    # 5. run monit
    # ---------------------------------------------------------------------
     - name: "start monit"
       command: "/opt/monit/bin/monit"

