#!/usr/bin/ansible-playbook 
---
### ---------------------------------------------------------------------
### playbooks/monit config
### ---------------------------------------------------------------------
###
###    1. copy source from monit site
###    2. untar the source
###    3. copy
###    4. config monit
###    5. run monit
###   
###
### ---------------------------------------------------------------------
- hosts: "{{ hosts }}"
  user: root
  serial: 1
  gather_facts: false

  tasks:
    #--------------------------------------------------------
    # 1. copy source from monit site
    # ---------------------------------------------------------------------
     - name: "copy source from monit site"
       shell: (cd /opt/; get http://mmonit.com/monit/dist/binary/5.11/monit-5.11-linux-x64.tar.gz)
    #--------------------------------------------------------
    # 2. untar 
    # ---------------------------------------------------------------------
     - name: "untar the source"
       shell: (cd /opt/ ;tar -zxvf /opt/monit-5.11-linux-x64.tar.gz )
    #--------------------------------------------------------
    # 3. copy
    # ---------------------------------------------------------------------
     - name: "cpy ther config file"
       shell: (cp /opt/monit-5.11/conf/monitrc  /etc/)
    #--------------------------------------------------------
    # 4. config monit
    # ---------------------------------------------------------------------
     - name: "changing permission monit"
       shell: (chmod 0700 /etc/monitrc)
    #--------------------------------------------------------
    # 5. run monit
    # ---------------------------------------------------------------------
     - name: "start monit"
       shell: (/opt/monit-5.9/bin/monit)

